\section{型付けの例}
\label{sec:typing:example}

\begin{align*}
  & P \; &\defeq& \; \\
  &\quad\quad \begin{array}{l}
    \Func
      {\code{is\_even}}{x}
      {\\ \quad \Let
        {\; \code{cond} \;}{\; x=0 \;}
        {\\ \quad \If{\; \code{cond} \;}{\; \true \\ \quad}
        {\\ \quad\quad \Let{\; x' \;}{\; x-1 \;}
        {\\ \quad\quad \Let{\; y \;}{\; \App{\code{is\_odd}}{x'} \;}
        {\\ \quad\quad \App{\mathrm{not}}{y} \;}}} \;}
      }, \\
    \Func
      {\code{is\_odd}}{x}
      {\\ \quad \Let
        {\; \code{cond} \;}{\; x = 0 \;}
        {\\ \quad \If{\; \code{cond} \;}{\; \false \\ \quad}
        {\\ \quad\quad \Let{\; x' \;}{\; x-1 \;}
        {\\ \quad\quad \Let{\; y \;}{\; \App{\code{is\_even}}{x'} \;}
        {\\ \quad\quad \App{\mathrm{not}}{y} \;}}} \;}
      } \\
  \end{array}, \\\\
  & \tau_\code{is\_even} \; \defeq \; \TyFunc{x}{\TyInt{\nu_x}{\nu_x \geq 0}}{\left\TyInt{\nu \; \middle}{\begin{array}{l}
            \paren{\paren{\nu_x \% 2 = 0} \Rightarrow \nu = 0} \land \\
            \paren{\paren{\nu_x \% 2 \neq 0} \Rightarrow \nu = 1}
  \end{array}\right}} \\
  & \tau_\code{is\_odd} \; \defeq \; \TyFunc{x}{\TyInt{\nu_x}{\nu_x \geq 0}}{\left\TyInt{\nu \; \middle}{\begin{array}{l}
            \paren{\paren{\nu_x \% 2 = 0} \Rightarrow \nu = 1} \land \\
            \paren{\paren{\nu_x \% 2 \neq 0} \Rightarrow \nu = 0}
  \end{array}\right}} \\
  & \phi_\code{cond} \; \defeq \; \begin{array}{l}
            \paren{\nu_x = 0} \Rightarrow \nu_\code{cond} = 0 \land \\
            \paren{\nu_x \neq 0} \Rightarrow \nu_\code{cond} = 1
  \end{array} \\
  & \tau_\code{cond} \; \defeq \; \TyInt{\nu_\code{cond} \;}{\phi_\code{cond}} \\
  & \tau_\mathrm{if} \; \defeq \; \TyInt{\nu_\code{if} \;}{\TODO{書く}} \\
  & \Gamma' \; \defeq \; \typed{x}{\TyInt{\nu_x \;}{\nu_x \geq 0}}, \typed{\code{cond}}{\tau_\code{cond}}, \phi_\code{cond} \land \nu_\code{cond} \neq 0, \typed{x'}{\TyInt{\nu_x'}{\nu_x' = \nu_x - 1}} \\\\
  &\hspace{-6em} \infer[\TyRuleSub] {
    \TyJudge{P}{}{\App{\code{is\_even}}{2}}{\TyInt{\nu \;}{\nu = 0}}
  } {
    \infer[\TyRuleApp] {
      \TyJudge{P}{}{\App{\code{is\_even}}{2}}{\left\TyInt{\nu \; \middle}{\begin{array}{l}
        \paren{\paren{2 \% 2 = 0} \Rightarrow \nu = 0} \land \\
        \paren{\paren{2 \%2 \neq 0} \Rightarrow \nu = 1}
      \end{array} \right}}
    } {
      \TyJudge{P}{}
        {\code{is\_even}}
        {\tau_\code{is\_even}}
      & \infer[\TyRuleSub] {
        \TyJudge{P}{}{2}{\TyInt{\nu_x}{\nu_x \geq 0}}
      } {
        \TyJudge{P}{}{2}{\TyInt{\nu_x}{\nu_x = 2}}
        & \infer[\SubTyRuleInt] {
          \SubTyJudge{P}{}{\TyInt{\nu_x}{\nu_x = 2}}{\TyInt{\nu_x}{\nu_x \geq 0}}
        } {
          \models \nu_x = 2 \Rightarrow \nu_x \geq 0
        }
      }
    }
    & \hspace{-4em} \infer[\SubTyRuleInt] {
      \SubTyJudge{P}{}{\left\TyInt{\nu \; \middle}{\begin{array}{l}
        \paren{\paren{2 \% 2 = 0} \Rightarrow \nu = 0} \land \\
        \paren{\paren{2 \%2 \neq 0} \Rightarrow \nu = 1}
      \end{array} \right}}{\TyInt{\nu \;}{\nu = 0}}
    } {
      \hspace{4em} \models \left\paren{\begin{array}{l}
        \paren{\paren{2 \% 2 = 0} \Rightarrow \nu = 0} \land \\
        \paren{\paren{2 \%2 \neq 0} \Rightarrow \nu = 1}
      \end{array}\right}
      \Rightarrow \nu = 0
    }
  } \\\\
  & \infer[\TyRuleFunc] {
    \TyJudge{P}{}{\code{is\_even}}{\tau_\code{is\_even}}
  } {
    \infer [\TyRuleLet] {
      \TyJudge
        {P}{\typed{x}{\TyInt{\nu_x}{\nu_x \geq 0}}}
        {\begin{array}{l}
          \Let{\; \code{cond} \;}{x = 0 \;}{ \\
          \If{\; \code{cond} \;}
            {\; \true \\}
            { \\
            \quad \Let{\; x'}{x-1 \;}{\\
            \quad \Let{\; y}{\App{\code{is\_odd}}{x' \;}}{ \\
            \quad \App{\mathrm{not}}{y}}}}}
        \end{array}}
        {\left\TyInt{\nu \; \middle}{\begin{array}{l}
          \paren{\paren{\nu_x \% 2 = 0} \Rightarrow \nu = 0} \land \\
          \paren{\paren{\nu_x \% 2 \neq 0} \Rightarrow \nu = 1}
        \end{array}\right}}
    } {
      \TyJudge{P}
        {\typed{x}{\TyInt{\nu_x}{\nu_x \geq 0}}}
        {x = 0}
        {\tau_\code{cond}}
      \quad\quad \mathrm{A}
    }
  } \\\\
  & \mathrm{A} \colon \\
  & \hspace{-6em} \infer[\TyRuleIf] {
    \TyJudge{P}
      {\typed{x}{\TyInt{\nu_x}{\nu_x \geq 0}}, \typed{\code{cond}}{\tau_\code{cond}}}
      {\If{\; \code{cond} \;}{\; \true \;}{\dots}}
      {\tau_\mathrm{if}}
  } {
    \infer[\TyRuleVar] {
      \TyJudge{P}
        {\begin{array}{l}
          \typed{x}{\TyInt{\nu_x}{\nu_x \geq 0}}, \\
          \typed{\code{cond}}{\tau_\code{cond}}
        \end{array}}
        {\code{cond}}
        {\tau_\code{cond}}
    } {
      \Gamma\paren{\code{cond}} = \tau_\code{cond}
    }
    \quad
    \infer {
      \TyJudge{P}
        {\begin{array}{l}
          \typed{x}{\TyInt{\nu_x}{\nu_x \geq 0}}, \\
          \typed{\code{cond}}{\tau_\code{cond}}, \\
          \phi_\code{cond} \land \nu_\code{cond} = 0
        \end{array}}
        {\true}
        {\tau_\mathrm{if}}
    } { \mathrm{B} }
    \quad
    \infer {
      \TyJudge{P}
        {\begin{array}{l}
          \typed{x}{\TyInt{\nu_x}{\nu_x \geq 0}}, \\
          \typed{\code{cond}}{\tau_\code{cond}}, \\
          \phi_\code{cond} \land \nu_\code{cond} \neq 0
        \end{array}}
        {\begin{array}{l}
          \Let{\; x'}{x-1 \;}{\\
          \Let{\; y}{\App{\code{is\_odd}}{x' \;}}{ \\
          \dots}}
        \end{array}}
        {\tau_\mathrm{if}}
    } { \mathrm{C} }
  } \\\\
  & \mathrm{B} \colon \\
  & \infer {
    \TyJudge{P}
      {
        \typed{x}{\TyInt{\nu_x}{\nu_x \geq 0}},
        \typed{\code{cond}}{\tau_\code{cond}},
        \phi_\code{cond} \land \nu_\code{cond} = 0
      }
      {\true}
      {\tau_\mathrm{if}}
  } {
    \TODO{書く}
  } \\\\
  & \mathrm{C} \colon \\
  & \hspace{-6em} \infer[\TyRuleLet] {
    \TyJudge{P}
      {
        \typed{x}{\TyInt{\nu_x}{\nu_x \geq 0}},
        \typed{\code{cond}}{\tau_\code{cond}},
        \phi_\code{cond} \land \nu_\code{cond} \neq 0
      }
      {
        \Let{\; x'}{x-1 \;}{ \;
        \Let{\; y}{\App{\code{is\_odd}}{x' \;}}{
        \dots}}
      }
      {\tau_\mathrm{if}}
  } {
    \infer[\TyRuleApp] {
      \TyJudge{P}{\begin{array}{l}
        \typed{x}{\TyInt{\nu_x}{\nu_x \geq 0}}, \\
        \typed{\code{cond}}{\tau_\code{cond}}, \\
        \phi_\code{cond} \land \nu_\code{cond} \neq 0
      \end{array}}
      {x - 1}
      {\TyInt{\nu_x'}{\nu_x' = \nu_x - 1}}
    } { \TODO{書く} }
    \quad
    \infer[\TyRuleLet] {
      \TyJudge{P}
        {\Gamma'}
        {\begin{array}{l}
          \Let{\; y}{\App{\code{is\_odd}}{x' \;}}{\\
          \App{\mathrm{not}}{y}}
        \end{array}}
        {\TODO{書く}}
    } {
      \mathrm{D}
      & \mathrm{E}
    }
  } \\\\
  & \mathrm{D} \colon \\
  & \infer[\TyRuleApp] {
    \TyJudge{P}{\Gamma'}
      {\App{\code{is\_odd}}{x'}}
      {\left\TyInt
        {\nu_y \; \middle}
        {\begin{array}{l}
            \paren{\paren{\nu_x' \% 2 = 0} \Rightarrow \nu_y = 1} \land \\
            \paren{\paren{\nu_x' \% 2 \neq 0} \Rightarrow \nu_y = 0}
        \end{array}\right}
      }
  } {
    \TyJudge{P}{\Gamma'}{\code{is\_odd}}{\tau_\code{is\_odd}}
    \quad
    \infer[\TyRuleSub] {
      \TyJudge{P}{\Gamma'}{x'}{\TyInt{\nu_x'}{\nu_x' \geq 0}}
    } {
      \infer[\TyRuleVar] {
        \TyJudge{P}{\Gamma'}{x'}{\TyInt{\nu_x'}{\nu_x' = \nu_x - 1}}
      } {
        \Gamma'\paren{x'} = \TyInt{\nu_x'}{\nu_x' = \nu_x - 1}
      }
      \quad
      \infer[\SubTyRuleInt] {
        \SubTyJudge{P}{\Gamma'}{\TyInt{\nu_x'}{\nu_x' = \nu_x - 1}}{\TyInt{\nu_x'}{\nu_x' \geq 0}}
      } {
        \models \paren{\sem{\Gamma'} \land \nu_x' = \nu_x - 1} \Rightarrow \nu_x' \geq 0
      }
    }
  } \\\\
  & \mathrm{E} \colon \\
  & \infer[\TyRuleApp] {
    \TyJudge{P}{\Gamma, \typed{y}{\left\TyInt
        {\nu_y \; \middle}
        {\begin{array}{l}
            \paren{\paren{\nu_x' \% 2 = 0} \Rightarrow \nu_y = 1} \land \\
            \paren{\paren{\nu_x' \% 2 \neq 0} \Rightarrow \nu_y = 0}
        \end{array}\right}
      }}{\App{\mathrm{not}}{y}}{\TODO{書く}}
  } {}
\end{align*}

